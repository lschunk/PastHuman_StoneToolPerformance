---
title: "Plots - cut marks/groovres"
author: "Lisa Schunk"
date: "`r Sys.time()`"
output:
  html_document:
    df_print: paged
---


```{r Knitr Options, include=FALSE}
knitr::opts_chunk$set(comment=NA, message=FALSE, indent="", error=TRUE)

```

---


# Goal of the script
This script plots the variables to visualise the results of the tool function experiment.  


```{r}
dir_in <- "analysis_S.wide/derived_data/"
dir_out <- "analysis_S.wide/plots"

```

Raw data must be located in `r paste0("~/", dir_in)`.  
Formatted data will be saved in `r paste0("~/", dir_out)`.

The knit directory for this script is the project directory.
---

# Load packages
```{r Libraries}
pack_to_load <- c("tidyverse", "R.utils", "ggplot2", "tools", "patchwork", "ggsci", "ggfortify", "wesanderson", "doBy")
sapply(pack_to_load, library, character.only = TRUE, logical.return = TRUE)

```



---

# Get name, path and information of the file 
```{r}
data_file <- list.files(dir_in, pattern = "\\.Rbin$", full.names = TRUE)

```


The imported file is:  
```{r, echo = FALSE}
data_file

```


# Load data into R object
```{r}
imp_data <- loadObject(data_file)
str(imp_data)

```

The imported file is: "`r paste0("~/", data_file)`"  


---

# Prepare variables
## Define numeric variables
```{r}
num.var <- 19:length(imp_data)

```

The following variables will be used: 

```{r, echo=FALSE}
for (i in num.var) cat("[",i,"] ", names(imp_data)[i], "\n", sep = "")

```


---

## Convert nm to µm for MaxDepth and add a new column for type ("Data point" or "Mean")
```{r}
imp_data <- mutate(imp_data, Max.depth.µm = Maximum.depth/1000, Type = "Data point")
imp_data

```

---

# Plot the maximum depth (facet plot = 1 plot per bone plate)
## All samples
```{r}
lev_Bone.plate <- levels(factor(imp_data$Bone.plate))
facet_titles <- paste(lev_Bone.plate, c("(cutting)", "(carving)", "(carving)"))
names(facet_titles) <- lev_Bone.plate

p.TFE <- ggplot(imp_data, aes(y = Max.depth.µm, x = Sample)) +
                   geom_point(aes(colour = Raw.material, shape = Edge.angle), size = 4) +
                   scale_y_reverse() +
                   facet_wrap(~Bone.plate, nrow = 3, scales = "free", 
                              labeller = labeller(Bone.plate = facet_titles)) + 
                   theme_classic() +
                   theme(legend.position = "bottom") +
                   guides(colour = "none") +
                   labs(y = "max. depth [µm]", x = "sample") +
                   labs(shape = "edge angle") +
                   scale_colour_manual(values = c("#046C9A", "#F2AD00"))
                 
plot(p.TFE)


#save to PDF
file_out <- paste0(basename(file_path_sans_ext(data_file)), "_TFE.pdf")
ggsave(filename = file_out, plot = p.TFE, path = dir_out, device = "pdf", 
       height = 240, width = 190, unit = "mm")

```


## without sample FLT8-10 ("outlier")
```{r}
# remove FLT8-10  
TFE_no.out <- imp_data[imp_data$Sample != "FLT8-10", ]


p.TFE_no.out <- ggplot(TFE_no.out, aes(y = Max.depth.µm, x = Sample)) +
                       geom_point(aes(colour = Raw.material, shape = Edge.angle), size = 4) +
                       scale_y_reverse() +
                       facet_wrap(~Bone.plate, nrow = 3, scales = "free", 
                                  labeller = labeller(Bone.plate = facet_titles)) + 
                       theme_classic() +
                       theme(legend.position = "bottom") +
                       guides(colour = "none") +
                       labs(y = "max. depth [µm]", x = "sample") +
                       labs(shape = "edge angle") +
                       scale_colour_manual(values = c("#046C9A", "#F2AD00"))
                 
plot(p.TFE_no.out)


#save to PDF
file_out_no.out <- paste0(basename(file_path_sans_ext(data_file)), "_TFE-no-outlier.pdf")
ggsave(filename = file_out_no.out, plot = p.TFE_no.out, path = dir_out, device = "pdf", 
       height = 240, width = 190, unit = "mm")

```


# Plot the width against the depth (facet plot = 1 plot per bone plate)
## All samples
```{r}
p.width_depth <- ggplot(imp_data, aes(x = Width, y = Depth, label = Sample)) +
                        geom_point(aes(colour = Raw.material, shape = Edge.angle), size = 4) +
                        geom_text(size = 3, hjust = 0.5, vjust = 1.5) +
                        scale_y_reverse() +
                        facet_wrap(~Bone.plate, nrow = 3, scales = "free", 
                                   labeller = labeller(Bone.plate = facet_titles)) + 
                        theme_classic() +
                        theme(legend.position = "bottom") +
                        guides(colour = "none") +
                        labs(x = "Width [µm]", y = "Depth [µm]") +
                        labs(shape = "edge angle") +
                        scale_colour_manual(values = c("#046C9A", "#F2AD00"))
                 
plot(p.width_depth)


#save to PDF
file_out_width.depth <- paste0(basename(file_path_sans_ext(data_file)), "_TFE_width-depth.pdf")
ggsave(filename = file_out_width.depth, plot = p.width_depth, path = dir_out, device = "pdf", 
       height = 240, width = 190, unit = "mm")

```


## Without sample FLT8-10 ("outlier")
```{r}
p.width_depth_no.out <- ggplot(TFE_no.out, aes(x = Width, y = Depth, label = Sample)) +
                        geom_point(aes(colour = Raw.material, shape = Edge.angle), size = 4) +
                        geom_text(size = 3, hjust = 0.5, vjust = 1.5) +
                        scale_y_reverse() +
                        facet_wrap(~Bone.plate, nrow = 3, scales = "free", 
                                   labeller = labeller(Bone.plate = facet_titles)) + 
                        theme_classic() +
                        theme(legend.position = "bottom") +
                        guides(colour = "none") +
                        labs(x = "Width [µm]", y = "Depth [µm]") +
                        labs(shape = "edge angle") +
                        scale_colour_manual(values = c("#046C9A", "#F2AD00"))
                 
plot(p.width_depth_no.out)


#save to PDF
file_out_width.dept_no.out <- paste0(basename(file_path_sans_ext(data_file)),
                                     "_TFE_width-depth_no-outlier.pdf")
ggsave(filename = file_out_width.dept_no.out, plot = p.width_depth_no.out, 
       path = dir_out, device = "pdf", height = 240, width = 190, unit = "mm")

```


---

# sessionInfo() and RStudio version

```{r}
sessionInfo()

```

RStudio version `r readLines("analysis/scripts/RStudioVersion.txt", n = 1)`.


---

# Cite R packages used
```{r Citation}
for (i in pack_to_load) print(citation(i), bibtex = FALSE)

```


---

END OF SCRIPT
